<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Keuangan</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Login Page */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .auth-box {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 450px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .auth-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 28px;
        }

        .auth-title {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }

        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: #f0f0f0;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .auth-tab.active {
            background: #667eea;
            color: white;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        /* Dashboard */
        .hidden {
            display: none !important;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 32px;
        }

        .btn-logout {
            background: #e74c3c;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        /* Widgets */
        .widget-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .widget {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .widget-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .widget-value {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .widget-label {
            color: #666;
            font-size: 14px;
        }

        .widget.time {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .widget.weather {
            background: linear-gradient(135deg, #00c6ff 0%, #0072ff 100%);
            color: white;
        }

        .widget.income {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .widget.expense {
            background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);
            color: white;
        }

        .widget.balance {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        /* Form */
        .form-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .currency-input {
            position: relative;
        }

        .currency-input input {
            padding-left: 45px;
        }

        .currency-input::before {
            content: 'Rp';
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-weight: 600;
            color: #666;
        }

        /* Transactions */
        .transaction-list {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .transaction-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .transaction-item.income {
            background: #e8f5e9;
            border-color: #4caf50;
        }

        .transaction-item.expense {
            background: #ffebee;
            border-color: #f44336;
        }

        .transaction-actions {
            display: flex;
            gap: 10px;
        }

        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            padding: 5px 10px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            font-size: 14px;
        }

        .footer strong {
            color: #ffd700;
        }
    </style>
</head>
<body>

<!-- Auth Page -->
<div id="authPage" class="auth-container">
    <div class="auth-box">
        <div class="auth-icon">💰</div>
        <h1 class="auth-title">Dashboard Keuangan</h1>
        <p style="text-align: center; color: #666; margin-bottom: 20px;">Kelola keuangan Anda dengan mudah</p>
        
        <div class="auth-tabs">
            <button class="auth-tab active" onclick="switchAuthTab('login')">Login</button>
            <button class="auth-tab" onclick="switchAuthTab('register')">Register</button>
        </div>

        <div id="loginForm">
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="loginUsername" placeholder="Masukkan username">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="loginPassword" placeholder="Masukkan password">
            </div>
            <button class="btn btn-primary" onclick="handleLogin()">Login</button>
        </div>

        <div id="registerForm" class="hidden">
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="registerUsername" placeholder="Masukkan username">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="registerPassword" placeholder="Masukkan password">
            </div>
            <button class="btn btn-primary" onclick="handleRegister()">Register</button>
        </div>

        <div class="footer" style="color: #333; margin-top: 30px;">
            By <strong style="color: #667eea;">Sienna Azalea Hermawan</strong> 2025 ©
        </div>
    </div>
</div>

<!-- Dashboard Page -->
<div id="dashboardPage" class="hidden">
    <div class="container">
        <div class="header">
            <div>
                <h1>Dashboard Keuangan 💰</h1>
                <p id="greeting"></p>
            </div>
            <button class="btn-logout" onclick="handleLogout()">Logout</button>
        </div>

        <!-- Time & Weather Widgets -->
        <div class="widget-grid">
            <div class="widget time">
                <div class="widget-header">🕐 Waktu & Tanggal</div>
                <div class="widget-value" id="currentTime"></div>
                <div class="widget-label" id="currentDate"></div>
            </div>
            <div class="widget weather">
                <div class="widget-header">☀️ Cuaca Hari Ini</div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div class="widget-value">28°C</div>
                        <div class="widget-label">Cerah Berawan</div>
                        <div class="widget-label" style="margin-top: 5px;">Phnom Penh, Cambodia</div>
                    </div>
                    <div style="font-size: 60px;">🌤️</div>
                </div>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="widget-grid">
            <div class="widget income">
                <div class="widget-header">📈 Total Income</div>
                <div class="widget-value" id="totalIncome">Rp 0</div>
                <div class="widget-label">Total Pemasukan</div>
            </div>
            <div class="widget expense">
                <div class="widget-header">📉 Total Expense</div>
                <div class="widget-value" id="totalExpense">Rp 0</div>
                <div class="widget-label">Total Pengeluaran</div>
            </div>
            <div class="widget balance">
                <div class="widget-header">💵 Balance</div>
                <div class="widget-value" id="balance">Rp 0</div>
                <div class="widget-label">Saldo</div>
            </div>
        </div>

        <!-- Add Transaction Button -->
        <button class="btn btn-primary" onclick="showAddForm()" style="margin-bottom: 20px; width: auto; padding: 12px 30px;">
            ➕ Tambah Transaksi
        </button>

        <!-- Add/Edit Form -->
        <div id="formContainer" class="form-container hidden">
            <h2 id="formTitle">Tambah Transaksi Baru</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>Tipe *</label>
                    <select id="transactionType" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 10px;">
                        <option value="income">Pemasukan (Income)</option>
                        <option value="expense">Pengeluaran (Expense)</option>
                    </select>
                </div>
                <div class="form-group currency-input">
                    <label>Jumlah *</label>
                    <input type="text" id="transactionAmount" placeholder="0">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Kategori *</label>
                    <input type="text" id="transactionCategory" placeholder="Contoh: Gaji, Makan, Transport">
                </div>
                <div class="form-group">
                    <label>Tanggal</label>
                    <input type="date" id="transactionDate">
                </div>
            </div>
            <div class="form-group">
                <label>Deskripsi</label>
                <input type="text" id="transactionDescription" placeholder="Tambahkan deskripsi (opsional)">
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" onclick="handleSubmit()">Simpan</button>
                <button class="btn btn-secondary" onclick="hideForm()">Batal</button>
            </div>
        </div>

        <!-- Transactions List -->
        <div class="transaction-list">
            <h2>Riwayat Transaksi</h2>
            <div id="transactionsList"></div>
        </div>

        <div class="footer">
            By <strong>Sienna Azalea Hermawan</strong> 2025 ©
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div id="confirmModal" class="modal">
    <div class="modal-content">
        <h2>Konfirmasi</h2>
        <p id="confirmMessage"></p>
        <div class="modal-buttons">
            <button class="btn btn-primary" onclick="confirmAction()">Lanjutkan</button>
            <button class="btn btn-secondary" onclick="closeModal()">Tidak</button>
        </div>
    </div>
</div>

<script>
// Global Variables
let currentUser = null;
let transactions = [];
let editingId = null;
let pendingAction = null;

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    const savedUser = localStorage.getItem('currentUser');
    if (savedUser) {
        currentUser = JSON.parse(savedUser);
        showDashboard();
    }
    updateTime();
    setInterval(updateTime, 1000);
    document.getElementById('transactionDate').valueAsDate = new Date();
});

// Auth Functions
function switchAuthTab(tab) {
    const tabs = document.querySelectorAll('.auth-tab');
    tabs.forEach(t => t.classList.remove('active'));
    
    if (tab === 'login') {
        tabs[0].classList.add('active');
        document.getElementById('loginForm').classList.remove('hidden');
        document.getElementById('registerForm').classList.add('hidden');
    } else {
        tabs[1].classList.add('active');
        document.getElementById('loginForm').classList.add('hidden');
        document.getElementById('registerForm').classList.remove('hidden');
    }
}

function handleLogin() {
    const username = document.getElementById('loginUsername').value;
    const password = document.getElementById('loginPassword').value;
    
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    const user = users.find(u => u.username === username && u.password === password);
    
    if (user) {
        currentUser = user;
        localStorage.setItem('currentUser', JSON.stringify(user));
        showDashboard();
    } else {
        alert('Username atau password salah!');
    }
}

function handleRegister() {
    const username = document.getElementById('registerUsername').value;
    const password = document.getElementById('registerPassword').value;
    
    if (!username || !password) {
        alert('Username dan password harus diisi!');
        return;
    }
    
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    
    if (users.find(u => u.username === username)) {
        alert('Username sudah digunakan!');
        return;
    }
    
    users.push({ id: Date.now(), username, password });
    localStorage.setItem('users', JSON.stringify(users));
    alert('Registrasi berhasil! Silakan login.');
    switchAuthTab('login');
}

function handleLogout() {
    currentUser = null;
    localStorage.removeItem('currentUser');
    document.getElementById('authPage').classList.remove('hidden');
    document.getElementById('dashboardPage').classList.add('hidden');
}

function showDashboard() {
    document.getElementById('authPage').classList.add('hidden');
    document.getElementById('dashboardPage').classList.remove('hidden');
    loadTransactions();
    updateSummary();
    updateGreeting();
}

// Time Functions
function updateTime() {
    const now = new Date();
    document.getElementById('currentTime').textContent = now.toLocaleTimeString('id-ID');
    document.getElementById('currentDate').textContent = now.toLocaleDateString('id-ID', { 
        weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
    });
}

function updateGreeting() {
    const hour = new Date().getHours();
    let greeting = 'Selamat Malam';
    if (hour < 12) greeting = 'Selamat Pagi';
    else if (hour < 15) greeting = 'Selamat Siang';
    else if (hour < 18) greeting = 'Selamat Sore';
    
    document.getElementById('greeting').textContent = `${greeting}, ${currentUser.username}!`;
}

// Transaction Functions
function loadTransactions() {
    const allTransactions = JSON.parse(localStorage.getItem('transactions') || '[]');
    transactions = allTransactions.filter(t => t.userId === currentUser.id);
    renderTransactions();
}

function saveTransactions() {
    const allTransactions = JSON.parse(localStorage.getItem('transactions') || '[]');
    const otherTransactions = allTransactions.filter(t => t.userId !== currentUser.id);
    localStorage.setItem('transactions', JSON.stringify([...otherTransactions, ...transactions]));
    renderTransactions();
    updateSummary();
}

function formatCurrency(amount) {
    return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(amount);
}

function formatInputCurrency(value) {
    const number = value.replace(/\D/g, '');
    return number.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
}

function parseInputCurrency(value) {
    return parseFloat(value.replace(/\./g, '')) || 0;
}

document.getElementById('transactionAmount').addEventListener('input', (e) => {
    e.target.value = formatInputCurrency(e.target.value);
});

function showAddForm() {
    editingId = null;
    document.getElementById('formTitle').textContent = 'Tambah Transaksi Baru';
    document.getElementById('transactionType').value = 'income';
    document.getElementById('transactionAmount').value = '';
    document.getElementById('transactionCategory').value = '';
    document.getElementById('transactionDescription').value = '';
    document.getElementById('transactionDate').valueAsDate = new Date();
    document.getElementById('formContainer').classList.remove('hidden');
}

function hideForm() {
    document.getElementById('formContainer').classList.add('hidden');
    editingId = null;
}

function handleSubmit() {
    const amount = document.getElementById('transactionAmount').value;
    const category = document.getElementById('transactionCategory').value;
    
    if (!amount || !category) {
        alert('Amount dan Category harus diisi!');
        return;
    }
    
    const message = editingId ? 
        'Apakah Anda yakin ingin mengupdate transaksi ini?' : 
        'Apakah Anda yakin ingin menambah transaksi ini?';
    
    pendingAction = () => {
        const transaction = {
            id: editingId || Date.now(),
            userId: currentUser.id,
            type: document.getElementById('transactionType').value,
            amount: parseInputCurrency(amount),
            category: category,
            description: document.getElementById('transactionDescription').value,
            date: document.getElementById('transactionDate').value
        };
        
        if (editingId) {
            transactions = transactions.map(t => t.id === editingId ? transaction : t);
        } else {
            transactions.push(transaction);
        }
        
        saveTransactions();
        hideForm();
        closeModal();
    };
    
    showConfirmModal(message);
}

function editTransaction(id) {
    const transaction = transactions.find(t => t.id === id);
    if (!transaction) return;
    
    editingId = id;
    document.getElementById('formTitle').textContent = 'Edit Transaksi';
    document.getElementById('transactionType').value = transaction.type;
    document.getElementById('transactionAmount').value = formatInputCurrency(transaction.amount.toString());
    document.getElementById('transactionCategory').value = transaction.category;
    document.getElementById('transactionDescription').value = transaction.description;
    document.getElementById('transactionDate').value = transaction.date;
    document.getElementById('formContainer').classList.remove('hidden');
}

function deleteTransaction(id) {
    pendingAction = () => {
        transactions = transactions.filter(t => t.id !== id);
        saveTransactions();
        closeModal();
    };
    showConfirmModal('Apakah Anda yakin ingin menghapus transaksi ini?');
}

function renderTransactions() {
    const container = document.getElementById('transactionsList');
    
    if (transactions.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">Belum ada transaksi</p>';
        return;
    }
    
    const sorted = [...transactions].sort((a, b) => b.id - a.id);
    
    container.innerHTML = sorted.map(t => `
        <div class="transaction-item ${t.type}">
            <div>
                <div style="font-weight: bold; font-size: 18px; color: ${t.type === 'income' ? '#4caf50' : '#f44336'};">
                    ${formatCurrency(t.amount)}
                </div>
                <div style="font-weight: 600; margin-top: 5px;">${t.category}</div>
                ${t.description ? `<div style="color: #666; font-size: 14px;">${t.description}</div>` : ''}
                <div style="color: #999; font-size: 12px; margin-top: 5px;">${t.date}</div>
            </div>
            <div class="transaction-actions">
                <button class="btn-icon" onclick="editTransaction(${t.id})" title="Edit">✏️</button>
                <button class="btn-icon" onclick="deleteTransaction(${t.id})" title="Delete">🗑️</button>
            </div>
        </div>
    `).join('');
}

function updateSummary() {
    const income = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
    const expense = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
    const balance = income - expense;
    
    document.getElementById('totalIncome').textContent = formatCurrency(income);
    document.getElementById('totalExpense').textContent = formatCurrency(expense);
    document.getElementById('balance').textContent = formatCurrency(balance);
}

// Modal Functions
function showConfirmModal(message) {
    document.getElementById('confirmMessage').textContent = message;
    document.getElementById('confirmModal').classList.add('show');
}

function closeModal() {
    document.getElementById('confirmModal').classList.remove('show');
    pendingAction = null;
}

function confirmAction() {
    if (pendingAction) {
        pendingAction();
    }
}
</script>

</body>
</html>
